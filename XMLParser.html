<!doctype html>
<html>
    <head><title>Nasjonale retningslinjer for behandling og rehabilitering ved hjerneslag</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <script type='text/javascript'>

   $(document).ready(function(){
    var inputArray = URLToArray();
    var recommendation;
    var no_recommendations = 0;
    
    $.get("results.xml",{}, function(xml){
      if(inputArray){
        no_recommendations = inputArray.length;
      }else{
        no_recommendations = parseInt(xml.firstChild.lastChild.getAttribute('id').substr(14))+1 //Fetches the last recommendation, gets the id and adds 1 (to get number of recommendations)
      }

      for(var i=0; i<no_recommendations; i++){
        var ID = 0;
        if(inputArray){
          ID = inputArray[i];
        }else{
          ID = i;
        }

        recommendation_element = $('#recommendation'+ID, xml)[0]; //Find the recommendation element in results.xml

        recommendations = recommendation_element.childNodes[3];
        $(recommendations).attr('id', recommendation_element.getAttribute('id'));
        $('#results').append((new XMLSerializer()).serializeToString(recommendations));

        heading = recommendation_element.childNodes[1];
        heading = "<a href='"+recommendation_element.getAttribute('link')+"'>"+(new XMLSerializer()).serializeToString(heading)+"</a>";

        breadcrumbs = $(recommendation_element.firstChild).find("a");
        output = $('<div></div>');

        for(var j=0; j<breadcrumbs.length; j++){
          var href = breadcrumbs[j].getAttribute("href");
          var title = breadcrumbs[j].textContent;

          output.append("<a href='"+href+"'>"+title+"</a> &#62 ");
        }

        $("#recommendation"+ID).prepend(output);

        $("#recommendation"+ID).prepend(heading);

      } 
      
    });

   });

   function URLToArray() {
      var url = window.location.search.substring(4);
      var array = null;
      
      if(url != ""){
         array = url.substring(url.indexOf('=') + 1).split(',');
      }

      return array;
    }
  </script>
  </head> 
  <body>
  <div id="results"></div>

  </body>
</html>